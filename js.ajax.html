<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>lab4: JS AJAX CRUD 실습</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        h1 { color: #333; }
        .controls { margin-bottom: 20px; border: 1px solid #ddd; padding: 15px; border-radius: 8px; }
        .controls input, .controls button { padding: 8px; margin: 5px; font-size: 1rem; }
        .controls button { cursor: pointer; }
        #dataList { list-style: none; padding: 0; }
        #dataList li { background: #f9f9f9; margin-bottom: 8px; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>

    <h1>제품 관리 (CRUD)</h1>
    
    <div class="controls">
        <h3>제품 정보 입력</h3>
        <input type="number" id="idInput" placeholder="ID (수정/삭제 시 입력)" min="1">
        <input type="text" id="nameInput" placeholder="제품명">
        <input type="number" id="priceInput" placeholder="가격">
        <input type="text" id="categoryInput" placeholder="카테고리">
    </div>

    <div class="controls">
        <h3>기능</h3>
        <button id="readBtn">조회 (Read)</button>
        <button id="createBtn">추가 (Create)</button>
        <button id="updateBtn">수정 (Update)</button>
        <button id="deleteBtn">삭제 (Delete)</button>
    </div>

    <hr>

    <h3>제품 목록</h3>
    <ul id="dataList"></ul>

    <script>
        const API_URL = 'http://localhost:3001/products';

        // HTML 요소 가져오기
        const idInput = document.getElementById('idInput');
        const nameInput = document.getElementById('nameInput');
        const priceInput = document.getElementById('priceInput');
        const categoryInput = document.getElementById('categoryInput');
        const readBtn = document.getElementById('readBtn');
        const createBtn = document.getElementById('createBtn');
        const updateBtn = document.getElementById('updateBtn');
        const deleteBtn = document.getElementById('deleteBtn');
        const dataList = document.getElementById('dataList');

        // 데이터베이스에서 모든 데이터 읽기 (GET)
        const readData = () => {
            fetch(API_URL)
                .then(response => response.json())
                .then(data => {
                    dataList.innerHTML = ''; // 기존 목록 초기화
                    data.forEach(item => {
                        const li = document.createElement('li');
                        li.textContent = `ID: ${item.id}, 제품명: ${item.name}, 가격: ${item.price}, 카테고리: ${item.category}`;
                        dataList.appendChild(li);
                    });
                })
                .catch(error => console.error('데이터 조회 중 오류 발생:', error));
        };

        // 새 데이터 추가 (POST)
        const createData = () => {
            const newData = {
                name: nameInput.value,
                price: parseInt(priceInput.value),
                category: categoryInput.value
            };
            fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(newData)
            })
            .then(response => response.json())
            .then(data => {
                alert('데이터가 성공적으로 추가되었습니다.');
                readData(); // 추가 후 목록 새로고침
            })
            .catch(error => console.error('데이터 추가 중 오류 발생:', error));
        };

        // 데이터 수정 (PUT)
        const updateData = () => {
            const id = idInput.value;
            if (!id) {
                alert('수정할 항목의 ID를 입력해주세요.');
                return;
            }
            const updatedData = {
                name: nameInput.value,
                price: parseInt(priceInput.value),
                category: categoryInput.value
            };
            fetch(`${API_URL}/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(updatedData)
            })
            .then(response => response.json())
            .then(data => {
                alert(`ID ${data.id}의 데이터가 성공적으로 수정되었습니다.`);
                readData(); // 수정 후 목록 새로고침
            })
            .catch(error => console.error('데이터 수정 중 오류 발생:', error));
        };

        // 데이터 삭제 (DELETE)
        const deleteData = () => {
            const id = idInput.value;
            if (!id) {
                alert('삭제할 항목의 ID를 입력해주세요.');
                return;
            }
            fetch(`${API_URL}/${id}`, {
                method: 'DELETE'
            })
            .then(() => {
                alert(`ID ${id}의 데이터가 성공적으로 삭제되었습니다.`);
                readData(); // 삭제 후 목록 새로고침
            })
            .catch(error => console.error('데이터 삭제 중 오류 발생:', error));
        };

        // 버튼 이벤트 리스너 연결
        readBtn.addEventListener('click', readData);
        createBtn.addEventListener('click', createData);
        updateBtn.addEventListener('click', updateData);
        deleteBtn.addEventListener('click', deleteData);

        // 페이지 로드 시 데이터 읽기
        document.addEventListener('DOMContentLoaded', readData);
    </script>

</body>
</html>
